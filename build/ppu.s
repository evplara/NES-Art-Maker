;
; File generated by cc65 v 2.19 - Git 3d7e388
;
	.fopt		compiler,"cc65 v 2.19 - Git 3d7e388"
	.setcpu		"6502"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	c_sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.export		_ppu_wait_vblank
	.export		_ppu_init
	.export		_ppu_write_vram
	.export		_ppu_fill_vram
	.export		_ppu_load_bg_palette

; ---------------------------------------------------------------
; void __near__ ppu_wait_vblank (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_ppu_wait_vblank: near

.segment	"CODE"

;
; while (PPUSTATUS & 0x80) {
;
L0008:	lda     $2002
	and     #$80
	bne     L0008
;
; while (!(PPUSTATUS & 0x80)) {
;
L0009:	lda     $2002
	and     #$80
	beq     L0009
;
; }
;
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ ppu_init (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_ppu_init: near

.segment	"CODE"

;
; ppu_wait_vblank();
;
	jsr     _ppu_wait_vblank
;
; PPUSCROLL = 0;
;
	lda     #$00
	sta     $2005
;
; PPUSCROLL = 0;
;
	sta     $2005
;
; PPUCTRL = 0x00;
;
	sta     $2000
;
; PPUMASK = 0x08;
;
	lda     #$08
	sta     $2001
;
; }
;
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ ppu_write_vram (unsigned int addr, unsigned char value)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_ppu_write_vram: near

.segment	"CODE"

;
; void ppu_write_vram(uint16_t addr, uint8_t value) {
;
	jsr     pusha
;
; PPUADDR = (uint8_t)(addr >> 8);
;
	ldy     #$02
	lda     (c_sp),y
	sta     $2006
;
; PPUADDR = (uint8_t)(addr & 0xFF);
;
	dey
	lda     (c_sp),y
	sta     $2006
;
; PPUDATA = value;
;
	dey
	lda     (c_sp),y
	sta     $2007
;
; }
;
	jmp     incsp3

.endproc

; ---------------------------------------------------------------
; void __near__ ppu_fill_vram (unsigned int addr, unsigned int len, unsigned char value)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_ppu_fill_vram: near

.segment	"CODE"

;
; void ppu_fill_vram(uint16_t addr, uint16_t len, uint8_t value) {
;
	jsr     pusha
;
; PPUADDR = (uint8_t)(addr >> 8);
;
	jsr     decsp2
	ldy     #$06
	lda     (c_sp),y
	sta     $2006
;
; PPUADDR = (uint8_t)(addr & 0xFF);
;
	dey
	lda     (c_sp),y
	sta     $2006
;
; for (i = 0; i < len; ++i) {
;
	ldy     #$00
	tya
	sta     (c_sp),y
	iny
	sta     (c_sp),y
L0002:	ldy     #$01
	lda     (c_sp),y
	tax
	dey
	lda     (c_sp),y
	ldy     #$03
	cmp     (c_sp),y
	txa
	iny
	sbc     (c_sp),y
	bcs     L0003
;
; PPUDATA = value;
;
	ldy     #$02
	lda     (c_sp),y
	sta     $2007
;
; for (i = 0; i < len; ++i) {
;
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
	jmp     L0002
;
; }
;
L0003:	jmp     incsp7

.endproc

; ---------------------------------------------------------------
; void __near__ ppu_load_bg_palette (const unsigned char *data, unsigned char count)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_ppu_load_bg_palette: near

.segment	"CODE"

;
; void ppu_load_bg_palette(const uint8_t* data, uint8_t count) {
;
	jsr     pusha
;
; PPUADDR = 0x3F;
;
	jsr     decsp1
	lda     #$3F
	sta     $2006
;
; PPUADDR = 0x00;
;
	lda     #$00
	sta     $2006
;
; for (i = 0; i < count; ++i) {
;
	tay
L0006:	sta     (c_sp),y
	iny
	cmp     (c_sp),y
	bcs     L0003
;
; PPUDATA = data[i];
;
	ldy     #$03
	lda     (c_sp),y
	sta     ptr1+1
	dey
	lda     (c_sp),y
	sta     ptr1
	ldy     #$00
	lda     (c_sp),y
	tay
	lda     (ptr1),y
	sta     $2007
;
; for (i = 0; i < count; ++i) {
;
	ldy     #$00
	clc
	lda     #$01
	adc     (c_sp),y
	jmp     L0006
;
; }
;
L0003:	jmp     incsp4

.endproc

